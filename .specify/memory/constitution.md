<!--
同期影響レポート - 憲法更新
================================================================================
バージョン変更: 1.0.0 → 1.1.0
変更された原則:
  - 全原則を日本語化
  - ドキュメント言語要件を明示化
追加セクション:
  - V. ドキュメント言語規約
削除セクション: なし
テンプレート状態:
  ✅ .specify/templates/plan-template.md - 互換性確認済み
  ✅ .specify/templates/spec-template.md - 互換性確認済み
  ✅ .specify/templates/tasks-template.md - 互換性確認済み
フォローアップTODO: なし
================================================================================
-->

# Diffuse Pilot プロジェクト憲法

## 基本原則

### I. コード品質の強制実施（絶対厳守）

すべてのコード変更は、コミット前に自動静的解析とフォーマットツールによる検証を必須とする。

**要件**:
- すべてのコード変更後にRuffによる静的解析を実行すること
- すべてのコード変更後にBlackによるコードフォーマットを実行すること
- すべてのプルリクエストでGitHub ActionsによるRuffとBlackのチェックを実行すること
- GitHub Actionsはlint/フォーマットエラーの自動修正を試みること
- 自動修正後も解決できないエラーがある場合、プルリクエストをマージしてはならない

**根拠**: 自動化された品質チェックにより、コードの一貫性を保証し、一般的なエラーを防止し、
手作業なしで統一されたコードベーススタイルを維持できる。これはボットアプリケーションにおいて、
コード品質が信頼性に直結するため不可欠である。

### II. 分岐網羅によるテスト駆動開発（絶対厳守）

すべての機能は、C1（分岐網羅）レベルを達成するユニットテストによって検証されなければならない。

**要件**:
- すべてのユニットテスト作成にはunittestフレームワークを使用すること
- テストはC1（分岐網羅）を達成すること - すべての条件分岐をテストすること
- テストは実装前に作成し、承認を得ること（TDDサイクル）
- テストカバレッジレポートを生成し、レビューすること
- C1カバレッジを達成していない新規コードはマージしてはならない

**根拠**: C1分岐網羅は、コード内のすべての意思決定ポイントが実行されることを保証し、
ステートメントカバレッジだけでは見逃す可能性のあるエッジケースやロジックエラーを
捕捉する。これは自律的に動作するボットアプリケーションにとって重要である。

### III. ボット優先のUX思想

本アプリケーションは主にボットアプリケーションであり、ユーザー体験の最適化は二の次である。

**要件**:
- 明示的に要求されない限り、UXデザインや改善は優先しない
- アクセシビリティが必要な場合は、WCAG 2.2に準拠すること
- インターフェースの洗練よりも、機能的な正確性と信頼性に注力すること
- ボットの動作、エラーハンドリング、ログ記録をUI考慮事項より優先すること

**根拠**: 自律型ボットアプリケーションとして、ユーザーインターフェースの美しさよりも
正確性、信頼性、保守性に焦点を当てるべきである。これにより、スコープクリープを防ぎ、
開発効率を維持できる。

### IV. パフォーマンス実用主義

パフォーマンス最適化は厳格な要件ではなく、コードの効率性と整頓を優先する。

**要件**:
- 不要な処理や冗長な操作を避けること
- コードは整頓され保守可能であること。早すぎる最適化は避けること
- パフォーマンス最適化は、測定可能な問題が発生した場合のみ実施すること
- 理論的なパフォーマンス向上のために複雑性を追加しないこと
- パフォーマンス最適化作業の前にプロファイリングを実施すること

**根拠**: 厳密なリアルタイム要件のないボットアプリケーションでは、保守可能で正確な
コードの方がマイクロ最適化よりも価値がある。この原則は過剰設計を防ぎ、コードベースを
アクセシブルに保つ。

### V. ドキュメント言語規約

人間向けのドキュメント、メッセージ、Copilotとのやりとりは日本語を使用する。

**要件**:
- プロジェクトドキュメント（README、仕様書、計画書など）は日本語で記述すること
- コミットメッセージは日本語で記述すること
- プルリクエストの説明は日本語で記述すること
- GitHub Copilotとのチャットでのやりとりは日本語で行うこと
- コード内のコメントは日本語で記述すること
- 技術的な専門用語は必要に応じて英語を併記してもよい

**根拠**: プロジェクトメンバーの主要言語が日本語である場合、母国語でのコミュニケーションにより
理解が深まり、ミスコミュニケーションのリスクが減少する。これにより開発効率と品質が向上する。

## コード品質要件

### 静的解析とフォーマット

**ツールチェーン**:
- **Ruff**: Pythonコードの主要静的解析ツール
  - 設定は`pyproject.toml`または`ruff.toml`で定義すること
  - すべてのルール違反は対処するか、正当な理由とともに明示的に無視すること
- **Black**: 一貫したスタイルのためのコードフォーマッター
  - 行の長さとフォーマットルールをプロジェクト全体で設定すること
  - 手動でのフォーマット調整は行わない。Blackの出力が正式なものとする

**Pre-commit統合**:
- RuffとBlackをローカルで実行するpre-commitフックを設定することを推奨する
- 開発者は変更をプッシュする前にチェックを実行すること

### テスト標準

**フレームワーク**: Python `unittest`

**カバレッジ要件**:
- 最小カバレッジ: C1（分岐網羅）
- カバレッジレポートはCI/CDパイプラインで生成すること
- カバレッジのギャップは文書化し、正当化するか埋めること

**テスト構成**:
- ユニットテストは`tests/unit/`に配置
- 統合テストは`tests/integration/`に配置
- 契約テストは`tests/contract/`に配置

## 開発ワークフロー

### プルリクエストプロセス

1. **PR前チェックリスト**:
   - [ ] ローカルでRuff静的解析に合格
   - [ ] Blackでフォーマット済み
   - [ ] ユニットテスト作成済みで合格
   - [ ] C1分岐カバレッジ達成
   - [ ] 必要に応じてドキュメント更新済み

2. **自動化されたCI/CDチェック**:
   - すべてのPythonファイルでRuff静的解析を実行
   - Blackフォーマットチェックを実行
   - 修正可能な問題の自動修正を試行
   - カバレッジレポート付きでテストスイートを実行
   - カバレッジレポートを閾値と比較

3. **マージ基準**:
   - すべてのCI/CDチェックが合格（グリーン）
   - 自動修正後に未解決のRuffまたはBlackエラーがない
   - テストカバレッジがC1閾値を満たす
   - コードレビュー承認（チームサイズ > 1の場合）

### GitHub Actions設定

**必須ワークフロー**:
- `lint-and-format.yml`: Ruff + Black実行、自動修正試行、修正をコミット
- `test.yml`: カバレッジレポート付きでunittestスイート実行
- `merge-gate.yml`: チェック失敗時のマージをブロック

## ガバナンス

### 改訂プロセス

憲法の改訂は以下のプロセスに従うこと:

1. 根拠と影響分析を含む変更提案
2. 既存のテンプレートとワークフローへの影響をレビュー
3. バージョンバンプを伴う憲法更新:
   - **MAJOR**: 原則の削除または互換性のない変更
   - **MINOR**: 新しい原則またはセクションの追加
   - **PATCH**: 明確化、誤字修正、文言改善
4. 依存する成果物（テンプレート、スクリプト、ドキュメント）の同期
5. 同期影響レポートで変更を文書化（ファイル先頭のHTMLコメント）

### コンプライアンス検証

- すべてのPRは検証のためにこの憲法を参照すること
- 違反はPR説明で文書化し、正当化すること
- 正当化なしに繰り返される違反はPR却下の原因となりうる
- 憲法コンプライアンスはコードレビュー基準の一部である

### バージョン管理

- **現在のバージョン**: 1.1.0
- **バージョン履歴**: gitコミット履歴と同期影響レポートで管理
- **レビューサイクル**: 四半期ごと、または主要なプロジェクト変更時に憲法をレビュー

**バージョン**: 1.1.0 | **制定日**: 2025-11-10 | **最終改訂日**: 2025-11-10
